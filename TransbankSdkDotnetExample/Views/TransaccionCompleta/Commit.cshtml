@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Confirmar Transacción";
}

<div class="breadcrumbs-container">
    <div class="breadcrumbs-items">
        <a href="/">Inicio</a>
        <img src="~/t-arrow.svg" alt="t-arrow" width="24" height="24" />
    </div>
    <div class="breadcrumbs-items">
        <a href="/transaccion-completa/index">Webpay Transacción Completa</a>
        <img src="~/t-arrow.svg" alt="t-arrow" width="24" height="24" />
    </div>
    <div class="breadcrumbs-items">
        <span class="current-breadcrumb">Confirmar</span>
    </div>
</div>

<h1>Transacción Completa - Confirmar transacción</h1>
<p class="mb-32">
    En este paso crucial, procederemos a confirmar la transacción con el objetivo de notificar a Transbank que hemos recibido la transacción de manera exitosa. Es fundamental destacar que si no se confirma la transacción, esta será caducada.
</p>

<h2 id="request">Paso 1: Datos recibidos</h2>
<p class="mb-32">
    Para confirmar la transacción, debes enviar el token correspondiente. En el caso de pagos a plazos, también debes incluir el ID de la consulta de cuotas. En algunos casos, será necesario proporcionar el índice del periodo diferido y un valor boolean indicando si se tomará el periodo de gracia.
</p>

<pre>
    <code class="language-csharp mb-32">
const tx = new TransaccionCompleta.Transaction(
  new Options(
    IntegrationCommerceCodes.TRANSACCION_COMPLETA,
    IntegrationApiKeys.WEBPAY,
    Environment.Integration
  )
);
const response = await tx.commit(token, idQueryInstallments, deferredPeriodIndex, gracePeriod);
    </code>
</pre>

<h2 id="response">Paso 2: Respuesta</h2>
<p class="mb-32">
    Una vez que la transacción ha sido confirmada Transbank proporcionará la siguiente información. Es fundamental conservar esta respuesta y verificar que el campo "response_code" tenga un valor de cero y que el campo "status" sea "AUTHORIZED".
</p>

<pre><code class="language-json mb-32">@Html.Raw(ViewBag.response)</code></pre>

<h2 id="form">¡Listo!</h2>
<p class="mb-16">Con la transacción confirmada, puedes mostrar al usuario una página de éxito de la transacción, proporcionándole la confirmación de que el proceso se ha completado con éxito.</p>

<p class="mb-16">Después de confirmar la transacción, podrás realizar otras operaciones útiles:</p>
<ul class="bullet-list mb-32">
    <li><span class="fw-700">Reembolsar:</span> Puedes reversar o anular el pago según ciertas condiciones comerciales.</li>
    <li><span class="fw-700">Consultar Estado:</span> Hasta 7 días después de realizada la transacción, podrás consultar el estado de la transacción.</li>
</ul>

<form asp-controller="TransaccionCompleta" asp-action="Refund" method="GET">
    <div class="tbk-card">
        <div class="input-container mb-32">
            <label for="amount" class="tbk-label">Monto a reembolsar</label>
            <input type="text" id="amount" name="amount" class="tbk-input-text" value="@ViewBag.Amount">
            <input type="hidden" name="token" value="@ViewBag.Token">
        </div>

        <div class="tbk-card-footer">
            <button type="submit" class="tbk-button primary">REEMBOLSAR</button>
        </div>
    </div>
</form>

<div class="mt-32 mb-32">
    <a asp-controller="TransaccionCompleta" 
       asp-action="Status" 
       asp-route-token="@ViewBag.Token" 
       class="tbk-button primary">
        CONSULTAR ESTADO
    </a>
</div>
