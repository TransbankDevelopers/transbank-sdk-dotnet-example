@model string
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="breadcrumbs-container">
    <div class="breadcrumbs-items">
        <a href="/">Inicio</a>
        <img src="~/t-arrow.svg" alt="t-arrow" width="24" height="24" />
    </div>
    <div class="breadcrumbs-items">
        <a href="/webpay-mall/create">Webpay Mall Diferido</a>
        <img src="~/t-arrow.svg" alt="t-arrow" width="24" height="24" />
    </div>
    <div class="breadcrumbs-items">
        <a class="current-breadcrumb" href="#">Capturar Transacción</a>
    </div>
</div>

<h1>Webpay Mall Diferido - Capturar Transacción</h1>
<p class="mb-32">
  En este paso debemos capturar la transacción para realmente capturar el dinero que habia sido previamente reservado al hacer la transacción.
</p>

<h2 id="request">Paso 1 - Petición:</h2>
<p class="mb-32">
  Para capturar una transacción necesitaremos el código de comercio de la tienda, Token, Orden de compra, Código de autorización y monto a capturar. Se hace de la siguiente manera.
</p>

<pre>
  <code class="language-csharp mb-32">
  var _transaction = MallTransaction.buildForIntegration(commerceCode, apiKey);
  var response = _transaction.Capture(childCommerceCode, token, buyOrder, authorizationCode, amount);
  </code>
</pre>

<h2 id="response">Paso 2: Respuesta</h2>
<p class="mb-32">
  Una vez creada la transacción, recibirás los siguientes datos de respuesta:
</p>

<pre>
    <code class="language-json mb-32">
        @Html.Raw(ViewBag.ResponseJson)
    </code>
</pre>

<h2 id="operations">¡Transacción Capturada!</h2>

<p class="mb-32">
    Con la transacción confirmada, puedes mostrar al usuario una página de éxito de la transacción, proporcionándole la confirmación de que el proceso se ha completado con éxito.
</p>

<h2>Otras Utilidades</h2>
<p>
    Después de confirmar la transacción, considera las siguientes utilidades adicionales:
</p>
<ul class="bullet-list mb-32">
  <li><span class="fw-700">Reembolso:</span> Evalúa la posibilidad de reversar o anular el pago según ciertas condiciones comerciales.</li>
  <li><span class="fw-700">Consultar Estado:</span> Hasta 7 días después de la transacción, puedes consultar su estado para obtener más detalles.</li>
</ul>



<form asp-action="refund" asp-controller="WebpayPlusMallDeferred" method="get">
    <div class="tbk-refund-card  mb-32">
        <div class="input-container">
            <label for="amount" class="tbk-label">Monto a reembolsar:</label>
            <input type="text" name="amount" class="tbk-input-text" value="@ViewBag.Amount" />

            <input type="hidden" name="childCommerceCode" value="@ViewBag.ChildCommerceCode" />
            <input type="hidden" name="authorizationCode" value="@ViewBag.AuthorizationCode" />
            <input type="hidden" name="buyOrder" value="@ViewBag.BuyOrder" />
            <input type="hidden" name="token" value="@ViewBag.Token" />
        </div>
        <div class="tbk-refund-button-container">
            <button class="tbk-button primary">REEMBOLSAR</button>
            <a asp-action="status" asp-controller="WebpayPlusMallDeferred" asp-route-token="@ViewBag.Token" class="tbk-button primary mb-32">
                CONSULTAR ESTADO
            </a>
        </div>
    </div>
</form>
